<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>Gyors szelvény bevitel</title>
<style>
body { font-family: Arial; padding: 20px; background-color: #f9f9f9; }
input, button, label, select { margin: 5px; padding: 5px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #999; padding: 8px; text-align: left; }
th { background-color: #555; color: white; }
tr:nth-child(even) { background-color: #eee; }
.hidden { display: none; }
button.deleteBtn { background-color: #e74c3c; color: white; border: none; padding: 3px 6px; cursor: pointer; }
.error { color: red; font-weight: bold; margin-top: 10px; }
.success { color: green; font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h1>Gyors szelvény bevitel</h1>

<label>Sportág:</label>
<select id="sport">
    <option value="Krikett">Krikett</option>
    <option value="Tenisz">Tenisz</option>
    <option value="Esport">Esport</option>
    <option value="Kosárlabda">Kosárlabda</option>
    <option value="Labdarúgás">Labdarúgás</option>
    <option value="Jégkorong">Jégkorong</option>
    <option value="Baseball">Baseball</option>
    <option value="Darts">Darts</option>
    <option value="Snooker">Snooker</option>
    <option value="Bowls">Bowls</option>
    <option value="Egyéb">Egyéb</option>
    <option value="MIX">MIX</option>
</select>

<label>Dátum (ÉÉÉÉMMDD):</label>
<input type="text" id="date" placeholder="20230101" maxlength="8" oninput="formatDate(this)">

<label>Mérkőzés 1 / Csapatok:</label>
<input type="text" id="match1" placeholder="Pl. Kenya-Ruanda">

<label>
<input type="checkbox" id="isCombo" onchange="toggleCombo()"> Kötés (több mérkőzés)
</label>

<div id="comboFields" class="hidden">
    <div id="matchContainer">
        <label>Mérkőzés 2 / Csapatok:</label>
        <input type="text" class="comboMatch" placeholder="Pl. Uganda-Tanzánia">
    </div>
    <button type="button" id="addMatchBtn" onclick="addComboMatch()">Új mérkőzés hozzáadása</button>
</div>

<label>Teljes odds:</label>
<input type="number" id="odds" step="0.01" placeholder="2.5">

<label>Tét (Ft):</label>
<input type="number" id="stake" placeholder="50000">

<label>GYŐZTES:</label>
<input type="text" id="winner" placeholder="Pl. Kenya">

<button onclick="addBet()">Hozzáad a táblázathoz</button>
<button onclick="exportCSV()">CSV mentés</button>

<div id="message"></div>

<table id="table">
<thead>
<tr>
<th>Sportág</th>
<th>Dátum</th>
<th>Mérkőzések</th>
<th>Kötés?</th>
<th>Teljes odds</th>
<th>Tét (Ft)</th>
<th>GYŐZTES</th>
<th>Művelet</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>

const bets = [];

/* ======================
   LOCAL STORAGE
====================== */

function saveToStorage(){
    localStorage.setItem('bets', JSON.stringify(bets));
}

function loadFromStorage(){
    const data = localStorage.getItem('bets');
    if(data){
        bets.push(...JSON.parse(data));
        renderTable();
    }
}

/* ======================
   UI FUNCTIONS
====================== */

function toggleCombo(){
    const comboFields = document.getElementById('comboFields');
    comboFields.classList.toggle('hidden');
    document.getElementById('addMatchBtn').disabled = false;
    const matchContainer = document.getElementById('matchContainer');
    matchContainer.innerHTML = '<label>Mérkőzés 2 / Csapatok:</label><input type="text" class="comboMatch">';
}

function addComboMatch(){
    const container = document.getElementById('matchContainer');
    const currentMatches = container.querySelectorAll('.comboMatch').length;
    if(currentMatches >= 5){
        alert("Maximum 5 mérkőzés lehet egy szelvényen.");
        document.getElementById('addMatchBtn').disabled = true;
        return;
    }
    const label = document.createElement('label');
    label.textContent = `Mérkőzés ${currentMatches + 2} / Csapatok:`;
    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'comboMatch';
    container.appendChild(label);
    container.appendChild(input);
}

function formatDate(input){
    input.value = input.value.replace(/\D/g,'');
    if(input.value.length > 8) input.value = input.value.slice(0,8);
}

/* ======================
   ADD BET
====================== */

function addBet(){

    const message = document.getElementById('message');
    message.innerHTML = '';

    const sport = document.getElementById('sport').value;
    const dateInput = document.getElementById('date').value.trim();
    const match1 = document.getElementById('match1').value.trim();
    const isCombo = document.getElementById('isCombo').checked;
    let matches = [match1];

    if(isCombo){
        const comboMatches = Array.from(document.querySelectorAll('.comboMatch'))
            .map(i => i.value.trim())
            .filter(v => v !== '');
        matches = matches.concat(comboMatches);
    }

    const odds = document.getElementById('odds').value.trim();
    const stake = document.getElementById('stake').value.trim();
    const winner = document.getElementById('winner').value.trim();

    if(!match1 || !odds || !stake || dateInput.length !== 8){
        message.innerHTML = '<div class="error">Hiányzó vagy hibás adat!</div>';
        return;
    }

    const formattedDate = dateInput.slice(0,4) + '.' + dateInput.slice(4,6) + '.' + dateInput.slice(6,8);

    const bet = {
        sport,
        date: dateInput,
        formattedDate,
        matches,
        isCombo: isCombo ? "Igen" : "Nem",
        odds,
        stake,
        winner
    };

    /* ======================
       DUPLICATION CHECK
    ====================== */

    const exists = bets.some(b => 
        b.date === dateInput &&
        JSON.stringify(b.matches) === JSON.stringify(matches) &&
        b.odds === odds &&
        b.stake === stake
    );

    if(exists){
        message.innerHTML = '<div class="error">Ez a szelvény már létezik!</div>';
        return;
    }

    bets.push(bet);
    saveToStorage();
    renderTable();
    resetFields();

    message.innerHTML = '<div class="success">Sikeresen hozzáadva!</div>';
}

/* ======================
   TABLE RENDER
====================== */

function renderTable(){
    bets.sort((a,b) => a.date - b.date);
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML = '';

    bets.forEach((b,index)=>{
        const tr = document.createElement('tr');
        const matchesStr = b.matches.join(' | ');

        [b.sport, b.formattedDate, matchesStr, b.isCombo, b.odds, b.stake, b.winner].forEach(v=>{
            const td = document.createElement('td');
            td.textContent = v;
            tr.appendChild(td);
        });

        const tdDel = document.createElement('td');
        const btnDel = document.createElement('button');
        btnDel.textContent = 'Törlés';
        btnDel.className = 'deleteBtn';
        btnDel.onclick = () => { 
            bets.splice(index,1); 
            saveToStorage();
            renderTable(); 
        };
        tdDel.appendChild(btnDel);
        tr.appendChild(tdDel);
        tbody.appendChild(tr);
    });
}

/* ======================
   RESET
====================== */

function resetFields(){
    document.getElementById('date').value = '';
    document.getElementById('match1').value = '';
    document.getElementById('odds').value = '';
    document.getElementById('stake').value = '';
    document.getElementById('winner').value = '';
    document.getElementById('isCombo').checked = false;
    document.getElementById('comboFields').classList.add('hidden');
    document.getElementById('matchContainer').innerHTML = '';
}

/* ======================
   CSV EXPORT
====================== */

function exportCSV(){
    let csvContent = '';
    bets.forEach(b=>{
        csvContent += `Sportág: ${b.sport}\n`;
        csvContent += `Dátum: ${b.formattedDate}\n`;
        csvContent += `Mérkőzések: ${b.matches.join(' | ')}\n`;
        if(b.isCombo === "Igen"){
            csvContent += `Kötés?: ${b.isCombo}\n`;
        }
        csvContent += `Teljes odds: ${b.odds}\n`;
        csvContent += `Tét (Ft): ${b.stake}\n`;
        csvContent += `GYŐZTES: ${b.winner}\n\n`;
    });

    const blob = new Blob([csvContent], {type:'text/csv;charset=utf-8;'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'szelvenyek.csv';
    link.click();
}

/* ======================
   LOAD ON START
====================== */

loadFromStorage();

</script>
</body>
</html>
